# 文件管理清单 - AEC 打断测试（流式播放版）

## 📅 更新日期
2025-10-27

---

## 📤 需要上传的文件

### 必须上传（核心文件）

1. **`modules/test_logic.py`**
   - 📍 位置: `ports/esp32/modules/test_logic.py`
   - 📝 说明: AEC 打断测试脚本（v2.0 流式播放版）
   - ⚠️ 重要: 包含 WiFi 配置，上传前请检查
   - 🔧 上传到设备: `/flash/test_logic.py`

### 可选上传（文档）

2. **`README_TEST.md`**
   - 📍 位置: `ports/esp32/modules/README_TEST.md`
   - 📝 说明: 快速使用指南
   - 🔧 可上传到设备: `/flash/README_TEST.md`（可选）

---

## 📥 需要更新的文件（代码库）

### C 代码（已完成）

1. **`modespsr.c`**
   - ✅ 已更新：队列大小从 1 增加到 10
   - ✅ 已更新：实现 AEC 参考信号缓冲区
   - ✅ 已更新：实现共享录音缓冲区
   - 📝 说明: ESP-SR MicroPython 模块

2. **`machine_i2s.c`**
   - ✅ 已更新：I2S 输出缓冲区从 2048 增加到 8192
   - 📝 说明: I2S 音频输出模块

### Python 代码（已完成）

3. **`modules/logic.py`**
   - ✅ 已更新：AEC 打断功能
   - ✅ 已更新：使用共享录音缓冲区
   - 📝 说明: 主应用逻辑（用于正式产品）

4. **`modules/test_logic.py`**
   - ✅ 新增：流式播放测试脚本
   - 📝 说明: AEC 打断功能测试（v2.0）

### 文档（已完成）

5. **`AEC打断测试指南.md`**
   - ✅ 已更新：流式播放说明
   - 📝 说明: 完整测试指南

6. **`流式播放版本更新说明.md`**
   - ✅ 新增：v2.0 更新说明
   - 📝 说明: 版本对比和技术细节

7. **`README_TEST.md`**
   - ✅ 新增：快速使用指南
   - 📝 说明: 简化的使用说明

8. **`文件管理清单.md`**
   - ✅ 新增：本文件
   - 📝 说明: 文件上传和删除清单

---

## 🗑️ 需要删除的文件

### 已删除（旧版本）

1. ~~`test_aec_interrupt.py`~~
   - ❌ 已删除
   - 📝 原因: v1.0 版本，存在内存溢出问题
   - 🔄 替代: `test_logic.py`（v2.0 流式播放版）

### 可以删除（重复/过时文档）

2. **`AEC_IMPLEMENTATION_CHECKLIST.md`**
   - 📍 位置: `ports/esp32/AEC_IMPLEMENTATION_CHECKLIST.md`
   - 📝 说明: 早期实现清单（已完成，可删除）

3. **`AEC_COMPLETE_IMPLEMENTATION_GUIDE.md`**
   - 📍 位置: `ports/esp32/AEC_COMPLETE_IMPLEMENTATION_GUIDE.md`
   - 📝 说明: 早期实现指南（已被新文档替代）

4. **`AEC实现方案总结.md`**
   - 📍 位置: `ports/esp32/AEC实现方案总结.md`
   - 📝 说明: 早期方案总结（已被新文档替代）

### 保留（有价值的文档）

- ✅ `打断功能失败根因分析.md` - 重要的问题分析
- ✅ `AEC打断功能修复说明.md` - 修复过程记录
- ✅ `I2S资源冲突修复说明.md` - 资源冲突解决方案
- ✅ `参考项目AEC实现详解.md` - 参考项目分析
- ✅ `参考项目录音与云端请求逻辑详解.md` - 参考逻辑分析
- ✅ `最终修复总结.md` - 完整修复清单
- ✅ `编译指南.md` - 编译说明

---

## 📋 完整文件列表

### 核心代码文件

```
ports/esp32/
├── modespsr.c                          ✅ AEC + 共享缓冲区
├── machine_i2s.c                       ✅ I2S 播放优化
└── modules/
    ├── logic.py                        ✅ 主应用（正式产品）
    ├── test_logic.py                   ✅ 测试脚本（v2.0）
    ├── main.py                         ✅ 启动入口
    └── README_TEST.md                  ✅ 快速指南
```

### 文档文件

```
ports/esp32/
├── 流式播放版本更新说明.md              ✅ v2.0 更新说明
├── AEC打断测试指南.md                   ✅ 完整测试指南
├── 文件管理清单.md                      ✅ 本文件
├── 打断功能失败根因分析.md              ✅ 问题分析
├── AEC打断功能修复说明.md               ✅ 修复记录
├── I2S资源冲突修复说明.md               ✅ I2S 冲突解决
├── 参考项目AEC实现详解.md               ✅ 参考项目分析
├── 参考项目录音与云端请求逻辑详解.md    ✅ 参考逻辑
├── 最终修复总结.md                      ✅ 修复总结
├── 编译指南.md                          ✅ 编译说明
├── readme-aec.md                       ✅ AEC 需求
└── ESP-SR_INTEGRATION_GUIDE.md         ✅ ESP-SR 集成指南
```

### 可删除的文件

```
ports/esp32/
├── AEC_IMPLEMENTATION_CHECKLIST.md      ❌ 可删除（已完成）
├── AEC_COMPLETE_IMPLEMENTATION_GUIDE.md ❌ 可删除（已替代）
└── AEC实现方案总结.md                   ❌ 可删除（已替代）
```

---

## 🚀 快速操作指南

### 上传测试脚本到设备

#### 方法 1: 使用 Thonny（推荐）
```
1. 打开 Thonny IDE
2. 连接到 ESP32 设备
3. 打开 ports/esp32/modules/test_logic.py
4. 另存为 -> MicroPython 设备 -> /flash/test_logic.py
5. 点击保存
```

#### 方法 2: 使用 ampy
```bash
cd ports/esp32/modules
ampy --port /dev/ttyUSB0 put test_logic.py /flash/test_logic.py
```

#### 方法 3: 使用 mpremote
```bash
cd ports/esp32/modules
mpremote connect /dev/ttyUSB0 fs cp test_logic.py :/flash/test_logic.py
```

### 删除过时文件（可选）

```bash
cd ports/esp32

# 删除早期文档（已被替代）
rm AEC_IMPLEMENTATION_CHECKLIST.md
rm AEC_COMPLETE_IMPLEMENTATION_GUIDE.md
rm AEC实现方案总结.md

# 确认删除
git status
```

---

## ✅ 验证清单

### 编译验证
- [ ] 代码编译成功：`idf.py build`
- [ ] 固件烧录成功：`idf.py flash`
- [ ] 串口监视器启动：`idf.py monitor`

### 功能验证
- [ ] ESP-SR 初始化成功
- [ ] WiFi 连接成功
- [ ] 流式下载连接成功
- [ ] 音频播放流畅
- [ ] 说 "嗨小乐" 能打断播放
- [ ] 打断后能正常录音
- [ ] 检测到静音后自动停止
- [ ] 能循环重复多轮

### 文档验证
- [ ] README_TEST.md 内容正确
- [ ] AEC打断测试指南.md 已更新
- [ ] 流式播放版本更新说明.md 完整
- [ ] 文件管理清单.md（本文件）准确

---

## 📞 技术支持

### 遇到问题？

1. **查看文档**
   - `README_TEST.md` - 快速开始
   - `AEC打断测试指南.md` - 详细指南
   - `打断功能失败根因分析.md` - 问题排查

2. **检查配置**
   - WiFi 配置是否正确
   - 音频 URL 是否可访问
   - 固件是否最新版本

3. **查看日志**
   - 使用 `idf.py monitor` 查看完整日志
   - 检查是否有错误信息

---

**维护者**: AI Assistant  
**最后更新**: 2025-10-27  
**版本**: v2.0

